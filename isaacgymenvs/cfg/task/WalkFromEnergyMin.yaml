# used to create the object
name: WalkFromEnergyMin

physics_engine: ${..physics_engine}

env:
  numEnvs: ${resolve_default:4096,${...num_envs}}
  envSpacing: 1.  # [m]

  initialPos: [0.0, 0.0, 0.3]

  numObservations: 83
  numActions: 16
  clipObservations: 5.0
  clipActions: 1.0

  cmdVelRanges:
    lin_x: [-1., 1.] # [m/s]
    lin_y: [-1., 1.] # [m/s]
    ang_z: [-0.5, 0.5] # [rad/s]

  plane:
    staticFriction: 1

  urdfAsset:
    defaultDofDriveMode: 4 # 0: none, 1: pos, 2: vel, 4: eff

  control:
    stiffness: 150 # [N*m/rad] <- taken from ODRI paper
    damping: 0.5   # [N*m*s/rad]

  randomForce:
    apply: False
    toggle_chance: 0.01
    strength: 5 # [N] max strength of force to apply per axis
    posRange: 0.2 # [m] +/- from center of robot

  learn:
    # rewards
    linVelRewardScale: 1.0 
    angVelRewardScale: 0.5 
    energyRewardScale: -0.00025 

    # normalization
    linVelScale: 2.0 
    linAccScale: 10.0
    angVelScale: 0.25
    dofPosScale: 0.5 
    dofVelScale: 0.05
    dofEffScale: 0.0025

    # episode length in seconds
    episodeLength_s: 30

  dofLowerLimits:
    front_spine_pitch_joint: -0.174 # [rad]
    rear_spine_pitch_joint: -0.174 # [rad]
    front_spine_yaw_joint: -0.261 # [rad]
    rear_spine_yaw_joint: -0.261 # [rad]

    front_left_hip_fe_joint: -0.785 # [rad]
    front_left_upper_leg_joint: -1.57 # [rad]
    front_left_lower_leg_joint: 0 # [rad]

    front_right_hip_fe_joint: -0.087 # [rad]
    front_right_upper_leg_joint: -1.57 # [rad]
    front_right_lower_leg_joint: -2.356 # [rad]

    rear_left_hip_fe_joint: -0.785 # [rad]
    rear_left_upper_leg_joint: -1.57 # [rad]
    rear_left_lower_leg_joint: 0 # [rad]

    rear_right_hip_fe_joint: -0.087 # [rad]
    rear_right_upper_leg_joint: -1.57 # [rad]
    rear_right_lower_leg_joint: -2.356 # [rad]

  dofUpperLimits:
    front_spine_pitch_joint: 0.174 # [rad]
    rear_spine_pitch_joint: 0.174 # [rad]
    front_spine_yaw_joint: 0.261 # [rad]
    rear_spine_yaw_joint: 0.261 # [rad]

    front_left_hip_fe_joint: 0.087 # [rad]
    front_left_upper_leg_joint: 1.57 # [rad]
    front_left_lower_leg_joint: 2.356 # [rad]

    front_right_hip_fe_joint: 0.785 # [rad]
    front_right_upper_leg_joint: 1.57 # [rad]
    front_right_lower_leg_joint: 0 # [rad]

    rear_left_hip_fe_joint: 0.087 # [rad]
    rear_left_upper_leg_joint: 1.57 # [rad]
    rear_left_lower_leg_joint: 2.356 # [rad]

    rear_right_hip_fe_joint: 0.785 # [rad]
    rear_right_upper_leg_joint: 1.57 # [rad]
    rear_right_lower_leg_joint: 2.356 # [rad]

  defaultJointAngles:
    front_spine_pitch_joint: 0 # [rad]
    rear_spine_pitch_joint: 0 # [rad]
    front_spine_yaw_joint: 0 # [rad]
    rear_spine_yaw_joint: 0 # [rad]

    front_left_hip_fe_joint: 0 # [rad]
    front_left_upper_leg_joint: 0 # [rad]
    front_left_lower_leg_joint: 0 # [rad]

    front_right_hip_fe_joint: 0 # [rad]
    front_right_upper_leg_joint: 0 # [rad]
    front_right_lower_leg_joint: 0 # [rad]

    rear_left_hip_fe_joint: 0 # [rad]
    rear_left_upper_leg_joint: 0 # [rad]
    rear_left_lower_leg_joint: 0 # [rad]

    rear_right_hip_fe_joint: 0 # [rad]
    rear_right_upper_leg_joint: 0 # [rad]
    rear_right_lower_leg_joint: 0 # [rad]

  viewer:
    refEnv: 0
    pos: [-2., -2., 2.]
    lookat: [1., 1, 0.25]

  enableCameraSensors: False

task:
  randomize: False
  randomization_params:
    frequency: 600 # How many environment steps between randomization
    observations:
      range: [0, 0.002]
      operation: "additive"
      distribution: "gaussian"
    actions:
      range: [0, 0.02]
      operation: "additive"
      distribution: "gaussian"
    sim_params:
      gravity:
        range: [0, 0.4]
        operation: "additive"
        distribution: "gaussian"
        schedule: "linear"
        schedule_steps: 3000
    actor_params:
      ester:
        color: True
        rigid_body_properties:
          mass:
            range: [0.5, 1.5]
            operation: "scaling"
            distribution: "uniform"
            setup_only: True
            schedule: "linear"
            schedule_steps: 3000
        rigid_shape_properties:
          friction:
            num_buckets: 500
            range: [0.7, 1.3]
            operation: "scaling"
            distribution: "uniform"
            schedule: "linear"
            schedule_steps: 3000
          restitution:
            range: [0, 0.7]
            operation: "scaling"
            distribution: "uniform"
            schedule: "linear"
            schedule_steps: 3000
        dof_properties:
          damping:
            range: [0.5, 1.5]
            operation: "scaling"
            distribution: "uniform"
            schedule: "linear"
            schedule_steps: 3000
          stiffness:
            range: [0.5, 1.5]
            operation: "scaling"
            distribution: "uniform"
            schedule: "linear"
            schedule_steps: 3000
          lower:
            range: [0, 0.01]
            operation: "additive"
            distribution: "gaussian"
            schedule: "linear"
            schedule_steps: 3000
          upper:
            range: [0, 0.01]
            operation: "additive"
            distribution: "gaussian"
            schedule: "linear"
            schedule_steps: 3000

sim:
  dt: 0.02
  substeps: 2
  up_axis: "z"
  use_gpu_pipeline: ${eq:${...pipeline},"gpu"}
  gravity: [0.0, 0.0, -9.81]
  physx:
    num_threads: ${....num_threads}
    solver_type: ${....solver_type}
    use_gpu: ${contains:"cuda",${....sim_device}} # set to False to run on CPU
    num_position_iterations: 4
    num_velocity_iterations: 1
    contact_offset: 0.02
    rest_offset: 0.0
    bounce_threshold_velocity: 0.2
    max_depenetration_velocity: 100.0
    default_buffer_size_multiplier: 5.0
    max_gpu_contact_pairs: 8388608 # 8*1024*1024
    num_subscenes: ${....num_subscenes}
    contact_collection: 1 # 0: CC_NEVER (don't collect contact info), 1: CC_LAST_SUBSTEP (collect only contacts on last substep), 2: CC_ALL_SUBSTEPS (default - all contacts)
